/**
 * Malware Analysis Validation Schemas
 */

import Joi from 'joi';

// Create/Update malware schema
const malwareSchema = Joi.object({
  name: Joi.string().min(2).max(200).required(),
  family: Joi.string().optional(),
  description: Joi.string().optional(),
  type: Joi.string()
    .valid('virus', 'worm', 'trojan', 'ransomware', 'spyware', 'adware', 'rootkit', 'backdoor', 'bot', 'other')
    .default('other'),
  severity: Joi.string().valid('critical', 'high', 'medium', 'low', 'info').default('medium'),
  hashes: Joi.object({
    md5: Joi.string().pattern(/^[a-f0-9]{32}$/i).optional(),
    sha1: Joi.string().pattern(/^[a-f0-9]{40}$/i).optional(),
    sha256: Joi.string().pattern(/^[a-f0-9]{64}$/i).optional(),
  }).optional(),
  file_size: Joi.number().min(0).optional(),
  file_type: Joi.string().optional(),
  capabilities: Joi.array().items(Joi.string()).optional(),
  behaviors: Joi.array().items(Joi.string()).optional(),
  network_indicators: Joi.array().items(Joi.object({
    type: Joi.string().valid('ip', 'domain', 'url').required(),
    value: Joi.string().required(),
  })).optional(),
  tags: Joi.array().items(Joi.string()).optional(),
  first_seen: Joi.date().iso().optional(),
  last_seen: Joi.date().iso().optional(),
  status: Joi.string().valid('active', 'inactive', 'unknown').default('active'),
}).min(1);

// Update malware schema (partial)
const malwareUpdateSchema = Joi.object({
  name: Joi.string().min(2).max(200).optional(),
  family: Joi.string().optional(),
  description: Joi.string().optional(),
  type: Joi.string()
    .valid('virus', 'worm', 'trojan', 'ransomware', 'spyware', 'adware', 'rootkit', 'backdoor', 'bot', 'other')
    .optional(),
  severity: Joi.string().valid('critical', 'high', 'medium', 'low', 'info').optional(),
  capabilities: Joi.array().items(Joi.string()).optional(),
  behaviors: Joi.array().items(Joi.string()).optional(),
  network_indicators: Joi.array().items(Joi.object({
    type: Joi.string().valid('ip', 'domain', 'url').required(),
    value: Joi.string().required(),
  })).optional(),
  tags: Joi.array().items(Joi.string()).optional(),
  last_seen: Joi.date().iso().optional(),
  status: Joi.string().valid('active', 'inactive', 'unknown').optional(),
}).min(1);

export default {
  malwareSchema,
  malwareUpdateSchema,
};

